<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Programas y fichas</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    body {
      margin: 0;
      background: #f3f4f6;
      color: #1f2933;
    }

    header {
      background: linear-gradient(135deg, #168a45, #0b5d28);
      color: #fff;
      padding: 2.5rem 1.5rem 2rem;
      box-shadow: 0 12px 30px -18px rgba(12, 68, 30, 0.8);
    }

    header h1 {
      margin: 0;
      font-size: clamp(1.8rem, 2.5vw, 2.4rem);
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    header p {
      margin-top: 0.75rem;
      max-width: 48rem;
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.85);
    }

    main {
      max-width: 1080px;
      margin: -1.5rem auto 3rem;
      padding: 0 1.5rem;
    }

    .status {
      background: #fff;
      border-left: 5px solid #168a45;
      border-radius: 0.85rem;
      padding: 1.25rem 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 18px 35px -25px rgba(15, 60, 30, 0.45);
      font-size: 1rem;
    }

    .status.error {
      border-color: #dc2626;
      background: #fee2e2;
      color: #7f1d1d;
      box-shadow: 0 16px 30px -25px rgba(185, 28, 28, 0.6);
    }

    .status.hidden {
      display: none;
    }

    .program-list {
      display: grid;
      gap: 1.5rem;
    }

    .program-card {
      background: #fff;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 22px 45px -30px rgba(15, 60, 30, 0.55);
      border: 1px solid rgba(22, 138, 69, 0.08);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .program-header {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      justify-content: space-between;
      gap: 0.75rem 1.25rem;
    }

    .program-name {
      margin: 0;
      font-size: clamp(1.35rem, 2.2vw, 1.8rem);
      color: #0b5d28;
      font-weight: 650;
      letter-spacing: 0.01em;
    }

    .program-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      font-size: 0.95rem;
      color: #475467;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.3rem 0.85rem;
      border-radius: 9999px;
      background: rgba(22, 138, 69, 0.12);
      color: #14532d;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .badge.secondary {
      background: rgba(14, 165, 233, 0.15);
      color: #0c4a6e;
    }

    .fiche-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.55rem;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .fiche-list li {
      background: #f1f5f9;
      color: #0f172a;
      padding: 0.4rem 0.9rem;
      border-radius: 9999px;
      font-variant-numeric: tabular-nums;
      font-weight: 600;
      letter-spacing: 0.04em;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7);
    }

    .empty-message {
      margin: 0;
      font-size: 0.95rem;
      color: #6b7280;
      font-style: italic;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background: #0f172a;
        color: #e2e8f0;
      }

      header {
        box-shadow: none;
      }

      header p {
        color: rgba(226, 232, 240, 0.75);
      }

      .status {
        background: #111827;
        color: #e2e8f0;
        border-color: #34d399;
        box-shadow: 0 20px 35px -25px rgba(15, 118, 110, 0.6);
      }

      .status.error {
        border-color: #f87171;
        background: rgba(127, 29, 29, 0.35);
        color: #fecaca;
      }

      .program-card {
        background: #111827;
        border-color: rgba(59, 130, 246, 0.08);
        box-shadow: 0 24px 45px -28px rgba(59, 130, 246, 0.45);
      }

      .program-name {
        color: #34d399;
      }

      .program-meta {
        color: #cbd5f5;
      }

      .badge {
        background: rgba(22, 163, 74, 0.25);
        color: #bbf7d0;
      }

      .badge.secondary {
        background: rgba(59, 130, 246, 0.25);
        color: #bfdbfe;
      }

      .fiche-list li {
        background: rgba(148, 163, 184, 0.25);
        color: #f8fafc;
        box-shadow: none;
      }

      .empty-message {
        color: #94a3b8;
      }
    }

    @media (max-width: 720px) {
      header {
        padding: 2rem 1.25rem 1.75rem;
      }

      main {
        margin-top: -1rem;
        padding: 0 1.1rem;
      }

      .program-card {
        padding: 1.2rem;
      }

      .program-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>Programas de formación</h1>
    <p>Consulta los códigos de programa, su versión vigente y las fichas activas asociadas a cada uno.</p>
  </header>
  <main>
    <section id="status" class="status">Cargando programas…</section>
    <div id="programList" class="program-list"></div>
  </main>

  <script>
    const statusElement = document.getElementById("status");
    const programList = document.getElementById("programList");

    function showStatus(message, type = "info") {
      statusElement.textContent = message;
      statusElement.classList.remove("hidden", "error");
      if (type === "error") {
        statusElement.classList.add("error");
      }
    }

    function hideStatus() {
      statusElement.classList.add("hidden");
    }

    function renderPrograms(programs) {
      programList.innerHTML = "";
      if (!programs.length) {
        const empty = document.createElement("p");
        empty.className = "empty-message";
        empty.textContent = "No hay fichas activas asociadas a programas en este momento.";
        programList.appendChild(empty);
        return;
      }

      for (const program of programs) {
        programList.appendChild(createProgramCard(program));
      }
    }

    function createProgramCard(program) {
      const card = document.createElement("article");
      card.className = "program-card";

      const header = document.createElement("div");
      header.className = "program-header";

      const name = document.createElement("h2");
      name.className = "program-name";
      name.textContent = program.name || "Programa sin nombre";

      const meta = document.createElement("div");
      meta.className = "program-meta";

      const codeBadge = document.createElement("span");
      codeBadge.className = "badge";
      codeBadge.textContent = program.code ? `Código ${program.code}` : "Código no disponible";
      meta.appendChild(codeBadge);

      const versionBadge = document.createElement("span");
      versionBadge.className = "badge secondary";
      versionBadge.textContent = program.version ? `Versión ${program.version}` : "Versión sin registrar";
      meta.appendChild(versionBadge);

      const countBadge = document.createElement("span");
      countBadge.className = "badge";
      const fichas = Array.isArray(program.fiches) ? program.fiches : [];
      countBadge.textContent = fichas.length === 1
        ? "1 ficha activa"
        : `${fichas.length} fichas activas`;
      meta.appendChild(countBadge);

      header.appendChild(name);
      header.appendChild(meta);

      card.appendChild(header);

      if (fichas.length) {
        const list = document.createElement("ul");
        list.className = "fiche-list";
        for (const ficha of fichas) {
          const item = document.createElement("li");
          item.textContent = ficha;
          list.appendChild(item);
        }
        card.appendChild(list);
      } else {
        const empty = document.createElement("p");
        empty.className = "empty-message";
        empty.textContent = "Este programa aún no tiene fichas activas asociadas.";
        card.appendChild(empty);
      }

      return card;
    }

    async function loadPrograms() {
      showStatus("Cargando programas…");
      try {
        const response = await fetch("/programas", { headers: { Accept: "application/json" } });
        if (!response.ok) {
          throw new Error(`Error al consultar programas: ${response.status}`);
        }
        const data = await response.json();
        const programs = Array.isArray(data.programs) ? data.programs : [];
        if (!programs.length) {
          showStatus("No hay programas para mostrar por ahora.");
          renderPrograms([]);
          return;
        }
        hideStatus();
        renderPrograms(programs);
      } catch (error) {
        console.error(error);
        showStatus("No fue posible cargar los programas. Intenta nuevamente más tarde.", "error");
      }
    }

    document.addEventListener("DOMContentLoaded", loadPrograms);
  </script>
</body>

</html>